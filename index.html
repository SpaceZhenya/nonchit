<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Умный Веб-ИИ</title>
  <style>
    /* стили как раньше */
    body{margin:0;padding:0;height:100vh;display:flex;justify-content:center;align-items:center;background:#eef2f5;font-family:Arial}
    .chat-container{width:360px;max-width:90vw;height:600px;background:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);display:flex;flex-direction:column;overflow:hidden}
    .chat-box{flex:1;padding:12px;overflow-y:auto;font-size:14px;line-height:1.4}
    .message{margin:8px 0;padding:8px 12px;border-radius:16px;max-width:80%;word-wrap:break-word}
    .message.user{align-self:flex-end;background:#dcf8c6}
    .message.assistant{align-self:flex-start;background:#f1f0f0}
    .input-group{display:flex;border-top:1px solid #ddd}
    #user-input{flex:1;border:none;padding:12px;font-size:14px;outline:none}
    #send-btn{border:none;background:#4caf50;color:#fff;padding:0 16px;cursor:pointer;font-size:14px}
    #send-btn:disabled{background:#9ccc9c;cursor:default}
  </style>
</head>
<body>
  <div class="chat-container">
    <div id="chat-box" class="chat-box"></div>
    <div class="input-group">
      <input id="user-input" type="text" placeholder="Напишите сообщение…" />
      <button id="send-btn">Отправить</button>
    </div>
  </div>

  <script>
    const HF_TOKEN = "hf_yourTokenHere";           // ← вставь свой HF-токен
    const HF_MODEL = "google/flan-t5-small";       // ← более умная модель

    const chatBox   = document.getElementById("chat-box");
    const userInput = document.getElementById("user-input");
    const sendBtn   = document.getElementById("send-btn");

    let history = [
      { role: "system", content: "Ты — умный, вежливый и краткий ассистент." }
    ];

    function appendMessage(text, role) {
      const div = document.createElement("div");
      div.classList.add("message", role);
      div.textContent = text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage() {
      const userText = userInput.value.trim();
      if (!userText) return;

      appendMessage(userText, "user");
      userInput.value = "";
      sendBtn.disabled = true;

      history.push({ role: "user", content: userText });

      // Формируем вход для HF API
      // Flan-T5 — seq2seq, поэтому передаём просто массив сообщений
      const payload = {
        inputs: history.map(m =>
          (m.role === "system" ? "**System:** " :
           m.role === "user"   ? "**User:** " :
                                 "**Assistant:** ") + m.content
        ).join("\n") + "\n**Assistant:**",
        parameters: {
          max_new_tokens: 64,
          temperature: 0.2,
          top_p: 0.9
        }
      };

      const res = await fetch(
        `https://api-inference.huggingface.co/models/${HF_MODEL}`, {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + HF_TOKEN,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        }
      );

      const json = await res.json();
      const botText = (json.generated_text || json[0]?.generated_text || "").trim() ||
                      "Упс, что-то пошло не так.";

      appendMessage(botText, "assistant");
      history.push({ role: "assistant", content: botText });

      sendBtn.disabled = false;
      userInput.focus();
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keydown", e => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>
